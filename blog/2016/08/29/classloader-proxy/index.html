<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<title>Proxy calls between classloaders &#8211; Eugene Petrenko</title>
<meta name="description" content="There are so many tricky stories around on classloaders in Java. Classloading is a powerful technique from the 
one hand. From the other it’s the place where it so easy to make mistakes. Some are simply afraid using them.
"/>
<meta name="keywords" content="jonnyzzz, Евгений Петренко, Eugene Petrenko, java, jvm, classloaders" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Proxy calls between classloaders -- Eugene Petrenko" />
<meta name="twitter:description" content="There are so many tricky stories around on classloaders in Java. Classloading is a powerful technique from the 
one hand. From the other it’s the place where it so easy to make mistakes. Some are simply afraid using them.
" />
<meta name="twitter:site" content="@jonnyzzz" />
<meta name="twitter:creator" content="@jonnyzzz" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://jonnyzzz.com/images/me.jpg" />

<!-- Open Graph -->

<meta property="og:type" content="article" />
<meta property="og:image" content="https://jonnyzzz.com/images/me.jpg" />
<meta property="og:title" content="Proxy calls between classloaders -- Eugene Petrenko" />
<meta property="og:description" content="There are so many tricky stories around on classloaders in Java. Classloading is a powerful technique from the 
one hand. From the other it’s the place where it so easy to make mistakes. Some are simply afraid using them.
" />
<meta property="og:url" content="https://jonnyzzz.com/blog/2016/08/29/classloader-proxy/" />
<meta property="og:site_name" content="Eugene Petrenko" />

<meta property="article:tag" content="jonnyzzz" />

<meta property="article:tag" content="Евгений Петренко" />

<meta property="article:tag" content="Eugene Petrenko" />


<meta property="article:tag" content="java" />

<meta property="article:tag" content="jvm" />

<meta property="article:tag" content="classloaders" />



<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="MJZCyfst2Tx4KyxbOIQu1fZyOSwA_JkQu73zJcfsl2g" />




<link rel="canonical" href="https://jonnyzzz.com/blog/2016/08/29/classloader-proxy/" />
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css" />

<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
<link rel="manifest" href="/images/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
      
		    <li><a href="/" >Home</a></li>
		  
		    <li><a href="/about/" >About</a></li>
		  
		    <li><a href="/blog/" >Blog</a></li>
		  
		    <li><a href="/projects/" >Projects</a></li>
		  
		    <li><a href="/talks/" >Talks</a></li>
		  
		    <li><a href="/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description" itemprop="description">@jonnyzzz personal page and blog</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#java" title="Pages tagged java">java</a></li><li><a href="/tags/#jvm" title="Pages tagged jvm">jvm</a></li><li><a href="/tags/#classloaders" title="Pages tagged classloaders">classloaders</a></li>
        </ul>
        
          <h1 class="entry-title">Proxy calls between classloaders</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2016-08-29T00:00:00+00:00"><i class="fa fa-calendar-o"></i> August 29, 2016</time></span>
        
        
        <span class="social-share-x">
  <a href="https://x.com/intent/tweet?hashtags=java,jvm,classloaders&amp;text=Proxy%20calls%20between%20classloaders&amp;url=https://jonnyzzz.com/blog/2016/08/29/classloader-proxy/&amp;via=jonnyzzz" title="Share on X" itemprop="X" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg> Post</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://jonnyzzz.com/blog/2016/08/29/classloader-proxy/" title="Share on Facebook" itemprop="Facebook" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg> Like</a>
</span>
<!-- /.social-share -->

        
      </footer>
      <div class="entry-content">
        <p>There are so many tricky stories around on classloaders in Java. Classloading is a powerful technique from the 
one hand. From the other it’s the place where it so easy to make mistakes. Some are simply afraid using them.</p>

<p>I solved a simple puzzle with isolating classes I want to share.</p>

<h1 id="backgrounds">Backgrounds</h1>

<p>There are integration tests in a project. Those integration tests starts several web applications, 
bind them together and to some black-box tests. 
The vital part of such tests is to provide a classpath isolation between test classes and classes 
of applications that are running.</p>

<p>To start each of those web servers I use Jetty Embedded. Well, I load Jetty classes for each 
web application I start within a separate classloaders hierarchy. I like Jetty, but I want to 
isolate any side effects, thus loading it several times, thanks it’s tiny, is the way to go.</p>

<p>All helper classes to start/stop/configure web applications forms an API that helps for a tests run.</p>

<p>It turns out to be tricky to isolate those runner classes from a test classpath. From one hand we’d 
like to have an APIs available for test class to use, from the other hand, it is still required 
to make sure the classpath of web application, hence Jetty Embedded it not polluted with test module 
dependencies.</p>

<h1 id="the-problem">The Problem</h1>

<p>Say we have and <code class="language-plaintext highlighter-rouge">API.jar</code> and <code class="language-plaintext highlighter-rouge">IMPL.jar</code>. We are looking on how to load the <code class="language-plaintext highlighter-rouge">IMPL.jar</code> with a clean
classpath and still have a change to bind it to the <code class="language-plaintext highlighter-rouge">API.jar</code> that is a part of some other huge classpath.</p>

<p>The goal is to the following:</p>

<ul>
  <li>Test framework uses <code class="language-plaintext highlighter-rouge">API.jar</code></li>
  <li>IMPL.jar also uses <code class="language-plaintext highlighter-rouge">API.jar</code>, but it does not see any test-related classes</li>
</ul>

<p>The problem is that it is test framework / test runner that loading test classes. We are unlikely to change that.
Otherwise we have to take care of test runners, IDEs, CI, debugging.</p>

<h1 id="obvious-solutions">Obvious solutions</h1>
<p>Load all classes within one JVM. This violates the task, but may be the easiest way. The future issue here 
can be a jar hell, if one has different libraries used in the application / tests or the loader.</p>

<p>Another solution could be in using OSGi. It’s a complicated framework that uses security manager to isolate
classes visibility.</p>

<p>Future solution with Java 9 modules is also a way to go. But for now, it’s too early.</p>

<h1 id="just-classloading">Just Classloading</h1>

<p>The most simple solution is to load classes with <em>child-first</em> classloader. This is <strong>NOT</strong> the way
to isolate dependencies, but at least this is the way to have IMPL.jar dependencies win on classloading.</p>

<p>There are at least two things to take case of</p>

<h2 id="case-1--jvm-classes">Case 1 : JVM classes</h2>
<p>Child first classloaders should still load JVM classes first.</p>

<p>It may turn out the classpath contains some classes that are now included into JVM. Those classes are 
still included into a package to provide a compatibility with older JVM versions. Those classes are 
simply ignored by the JVM when default classloading is used.</p>

<p>It may generate tricky issues when child first classloader attempts to load wrong classes since 
those classes will likely register themselves in the OS.</p>

<p>The solution here is the following. We crete a classloader:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">  <span class="n">val</span> <span class="n">jvmClassLoaderDelegate</span> <span class="o">=</span> <span class="nc">URLClassLoader</span><span class="o">(</span><span class="k">new</span> <span class="no">URL</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="kc">null</span><span class="o">)</span></code></pre></figure>

<p>This classloader is the first one to check in the child classloader implementation. It is the easiest way I know
to delegate to the system classloader. The Classloader itself uses native method in order to delegate to it.</p>

<h2 id="case-2-resources">Case 2: Resources</h2>

<p>It’s so easy to implement child first classloader. It is also so easy to forget about resources. The child first
strategy must be implemented for resources too. Otherwise, it may break some libraries which uses resources.</p>

<p>Finally classloading with child first delegation does not solve the initial problem. It does not allow to 
fully isolate test classes (e.g. test framework) from <code class="language-plaintext highlighter-rouge">IMPL.jar</code> classes</p>

<h1 id="the-proxy-trick">The Proxy Trick</h1>

<p>The idea is to load <code class="language-plaintext highlighter-rouge">API.jar</code> twice and than use to <code class="language-plaintext highlighter-rouge">java.lang.reflect.Proxy</code> to bind interfaces part from 
tests classspath to implementations.</p>

<p>A trick is to have yet another classloader with <code class="language-plaintext highlighter-rouge">null</code> as parent. The loader classpath includes 
only <code class="language-plaintext highlighter-rouge">API.jar</code>, <code class="language-plaintext highlighter-rouge">IMPL.jar</code> and dependencies of <code class="language-plaintext highlighter-rouge">IMPL.jar</code>.</p>

<p>Next we create a <code class="language-plaintext highlighter-rouge">java.lang.reflect.Proxy</code> to create an instance of an API interface that delegates
to the implementation class that is loaded by the other classloader. We are not able to cast here,
since we have <code class="language-plaintext highlighter-rouge">API.jar</code> loaded twice.</p>

<p>Unfortunately, this will only work when API interface methods uses JVM classes as parameters 
and return types. There are no common 
classloaders between <code class="language-plaintext highlighter-rouge">IMPL.jar</code> and tests, thus ClassCastException will be thrown for other types.</p>

<h1 id="recursive-proxy-trick">Recursive Proxy Trick</h1>

<p>The last limitation can be solved by a bit more complicated trick of 3 steps</p>

<ul>
  <li>Create a proxy for API interface</li>
  <li>In the implementation, check all parameter types and proxy every parameter with non system classloader</li>
  <li>In the implementation, proxy return values in opposite way</li>
  <li>Apply the following proxies recursively if <code class="language-plaintext highlighter-rouge">API.jar</code> interfaces are complex</li>
</ul>

<p>This approach allows to use JVM classes and <code class="language-plaintext highlighter-rouge">API.jar</code> interfaces between the bound. It will not work 
with classes, since it is the limitation of <code class="language-plaintext highlighter-rouge">java.lang.reflect.Proxy</code>.</p>

<p>The overall trick is implemented as follows</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*
 * creates a proxy for an object obj loaded in sourceLoader hierarchy 
 * that is visible in destLoader as destClass interface
 * assuming all methods of destClass are implemented in obj
 * exactly with same signature
*/</span>
<span class="nc">Object</span> <span class="nf">proxy</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span>
             <span class="kd">final</span> <span class="nc">ClassLoader</span> <span class="n">sourceLoader</span><span class="o">,</span>
             <span class="kd">final</span> <span class="nc">ClassLoader</span> <span class="n">destLoader</span><span class="o">,</span>
             <span class="kd">final</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">destClass</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">return</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">destLoader</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]{</span><span class="n">destClass</span><span class="o">},</span>
          <span class="o">(</span><span class="n">proxy</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span> <span class="o">-&gt;</span>
                  <span class="n">threadClassLoader</span><span class="o">(</span><span class="n">sourceLoader</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="kd">final</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">mappedArgTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[</span><span class="n">args</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
                    <span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">mappedArgs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">mappedArgTypes</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
                    <span class="kd">final</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">sourceTypes</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">();</span>
                    
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">args</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mappedArgTypes</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                      <span class="k">if</span> <span class="o">(</span><span class="n">sourceTypes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getClassLoader</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">mappedArgTypes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">sourceTypes</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                        <span class="n">mappedArgs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">mappedArgTypes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">sourceLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">sourceTypes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">());</span>
                        <span class="n">mappedArgs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">destLoader</span><span class="o">,</span> <span class="n">sourceLoader</span><span class="o">,</span> <span class="n">mappedArgTypes</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                      <span class="o">}</span>
                    <span class="o">}</span>

                    <span class="kd">final</span> <span class="nc">Method</span> <span class="n">realMethod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">mappedArgTypes</span><span class="o">);</span>
                    <span class="kd">final</span> <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">realMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">mappedArgs</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getReturnType</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="nf">proxy</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">sourceLoader</span><span class="o">,</span> <span class="n">destLoader</span><span class="o">,</span> <span class="n">method</span><span class="o">.</span><span class="na">getReturnType</span><span class="o">());</span>
                  <span class="o">}));</span>
  <span class="o">}</span></code></pre></figure>

<h1 id="limitations">Limitations</h1>

<p>Current implementation works only with API interfaces. It does not allow sharing classes or enums. 
Enums from <code class="language-plaintext highlighter-rouge">API.jar</code> can be easily supported be adding an explicit checking. 
Classes cannot be mapped this way. At least because it is not allowed in <code class="language-plaintext highlighter-rouge">java.lang.reflect.Proxy</code>. 
From the other hand, it’s not clear how class state can be transferred at all.</p>

<h1 id="side-note">Side Note</h1>

<p>It may be necessary to change <code class="language-plaintext highlighter-rouge">Thread#contextClassloader</code> to the right one before calling a 
method from different classloader. This trick makes dynamic classloading in libraries work 
correctly for some cases. Otherwise, there is a possibility that a class from another classpath
is created from <code class="language-plaintext highlighter-rouge">IMPL.jar</code> code (say, via <code class="language-plaintext highlighter-rouge">Class#forName</code> call)</p>

<h1 id="conclusion">Conclusion</h1>

<p>I used the approach to implement integration tests that are running several web application 
instances within one JVM. All instances are now isolated from each other and from tests classpath.</p>

<p>Running everything within one JVM helps to avoid issues with leaked processes or applications as well as
allows one to debug every application or even all applications easily!</p>


        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2016/03/08/gradle-for-dsl/" class="btn" title="A DSL Workbench with Gradle and Kotlin">Previous</a>
      
      
        <a href="/blog/2016/09/02/dsl-building/" class="btn" title="Building DSL Instead of an IDE Plugin">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>
  &copy; 2005—2026 Eugene Petrenko.
  <br />
  Unless otherwise noted, the content on the website is licensed under a
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> license.
  <br />
  Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using
  the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.
</span>
<div class="social-icons">
  <a href="https://x.com/jonnyzzz" title="Eugene Petrenko on X" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
  <a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a>
  <a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a>
  <a href="/feed.xml" title="Atom/RSS feed"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script>
  // Open external links in new tab
  Array.from(document.links).forEach(link => {
    // For development: 0.0.0.0, localhost, 127.0.0.1 are all local
    const localHosts = ['localhost', '127.0.0.1', '0.0.0.0'];
    const linkIsLocal = localHosts.includes(link.hostname);
    const pageIsLocal = localHosts.includes(window.location.hostname);

    // Internal if: both are local dev hosts, or hostnames match exactly
    const isInternal = (linkIsLocal && pageIsLocal) ||
                       (link.hostname === window.location.hostname);

    if (!isInternal) {
      link.target = '_blank';
    }
  });
</script>


<!-- Google Analytics (gtag.js) -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied'
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BXXDX0ERFP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BXXDX0ERFP');
</script>
<!-- End Google Analytics -->




<!--SYNTAX HIGHLIGHTER - Lazy loads PrismJS only when code blocks are present-->
<script>
(function() {
  // Check if page has any code blocks that need highlighting
  if (!document.querySelector('pre code, code[class*="language-"]')) return;

  // Load CSS
  var cssFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.css'
  ];
  cssFiles.forEach(function(href) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  });

  // Load JS in sequence (core first, then plugins)
  var jsFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/show-language/prism-show-language.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js'
  ];

  function loadScript(index) {
    if (index >= jsFiles.length) {
      // All scripts loaded, highlight code
      if (window.Prism) Prism.highlightAll();
      return;
    }
    var script = document.createElement('script');
    script.src = jsFiles[index];
    script.onload = function() { loadScript(index + 1); };
    document.head.appendChild(script);
  }
  loadScript(0);
})();
</script>



</body>
</html>
