<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<title>Sealed classes and 'when' expression &#8211; Eugene Petrenko</title>
<meta name="description" content="‘when’ expression as pattern-matching in Kotlin
"/>
<meta name="keywords" content="jonnyzzz, Евгений Петренко, Eugene Petrenko, kotlin, kotlin-bytecode, jvm, tip" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Sealed classes and 'when' expression -- Eugene Petrenko" />
<meta name="twitter:description" content="‘when’ expression as pattern-matching in Kotlin
" />
<meta name="twitter:site" content="@jonnyzzz" />
<meta name="twitter:creator" content="@jonnyzzz" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://jonnyzzz.com/images/me.jpg" />

<!-- Open Graph -->

<meta property="og:type" content="article" />
<meta property="og:image" content="https://jonnyzzz.com/images/me.jpg" />
<meta property="og:title" content="Sealed classes and 'when' expression -- Eugene Petrenko" />
<meta property="og:description" content="‘when’ expression as pattern-matching in Kotlin
" />
<meta property="og:url" content="https://jonnyzzz.com/blog/2017/03/29/when-for-sealed-classes/" />
<meta property="og:site_name" content="Eugene Petrenko" />

<meta property="article:tag" content="jonnyzzz" />

<meta property="article:tag" content="Евгений Петренко" />

<meta property="article:tag" content="Eugene Petrenko" />


<meta property="article:tag" content="kotlin" />

<meta property="article:tag" content="kotlin-bytecode" />

<meta property="article:tag" content="jvm" />

<meta property="article:tag" content="tip" />



<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="MJZCyfst2Tx4KyxbOIQu1fZyOSwA_JkQu73zJcfsl2g" />




<link rel="canonical" href="https://jonnyzzz.com/blog/2017/03/29/when-for-sealed-classes/" />
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css" />

<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
<link rel="manifest" href="/images/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
      
		    <li><a href="/" >Home</a></li>
		  
		    <li><a href="/about/" >About</a></li>
		  
		    <li><a href="/blog/" >Blog</a></li>
		  
		    <li><a href="/projects/" >Projects</a></li>
		  
		    <li><a href="/talks/" >Talks</a></li>
		  
		    <li><a href="/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description" itemprop="description">Founding Engineering Leader | Agentic AI DevTools & Experience</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#kotlin" title="Pages tagged kotlin">kotlin</a></li><li><a href="/tags/#kotlin-bytecode" title="Pages tagged kotlin-bytecode">kotlin-bytecode</a></li><li><a href="/tags/#jvm" title="Pages tagged jvm">jvm</a></li><li><a href="/tags/#tip" title="Pages tagged tip">tip</a></li>
        </ul>
        
          <h1 class="entry-title">Sealed classes and 'when' expression</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2017-03-29T00:00:00+00:00">March 29, 2017</time></span>
        
        
        <span class="social-share-x">
  <a href="https://x.com/intent/tweet?hashtags=kotlin,kotlin-bytecode,jvm,tip&amp;text=Sealed%20classes%20and%20&#39;when&#39;%20expression&amp;url=https://jonnyzzz.com/blog/2017/03/29/when-for-sealed-classes/&amp;via=jonnyzzz" title="Share on X" itemprop="X" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg> Post</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://jonnyzzz.com/blog/2017/03/29/when-for-sealed-classes/" title="Share on Facebook" itemprop="Facebook" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg> Like</a>
</span>
<!-- /.social-share -->

      </footer>
      <div class="entry-content">
        <p>‘when’ expression as pattern-matching in Kotlin</p>

<p>Let’s consider the following case. You need to return 3 different return values from a function. Each 
value is associated with information. Say we do <a href="https://en.wikipedia.org/wiki/Authentication">authentication</a> 
and <a href="https://en.wikipedia.org/wiki/Authorization">authorization</a> in one shot. The results 
are:</p>
<ul>
  <li>not authenticated + error message</li>
  <li>not authorized + userId + error message</li>
  <li>authenticated and authorized + userId</li>
</ul>

<p><a href="https://en.wikipedia.org/wiki/Algebraic_data_type">Algebraic data types</a> looks the best fit here, 
but we have no such in Java.</p>

<p>A possible approach is to use enum for that. But enum does not allow us to pass additional information
with each call. To fix that we may return a value object with all fields, but it will add a level 
of mess to the callee code.</p>

<p>Yet another apporach is to make the method return a base class or interface and to have an 
implementation per return case. This would make code cleaner, but with a cost of <code class="language-plaintext highlighter-rouge">instenceof</code>
or <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor pattern</a> impementation.</p>

<p>A nice thing in Kotlin is we are able to use 
<a href="https://kotlinlang.org/docs/reference/control-flow.html#when-expression">when expression</a> 
to make this checking code read better. In <a href="/blog/2017/03/15/switch-to-when/">a recent post</a>
I covered <code class="language-plaintext highlighter-rouge">when</code> expression benefits.</p>

<p>We may also make sure we check all possible branchs in <code class="language-plaintext highlighter-rouge">when</code> expression. For this we only need to 
use <a href="https://kotlinlang.org/docs/reference/classes.html#sealed-classes">sealed classes</a> for 
return objects hierarchy.</p>

<p>This is example implementation code with sealed class and <code class="language-plaintext highlighter-rouge">when</code> expression:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">class</span> <span class="nc">UserId</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="kd">class</span> <span class="nc">MagicToken</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">AuthResult</span> <span class="p">{</span>
  <span class="kd">class</span> <span class="nc">NotAuthenticated</span><span class="p">(</span><span class="kd">val</span> <span class="py">message</span><span class="p">:</span><span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">AuthResult</span><span class="p">()</span>
  <span class="kd">class</span> <span class="nc">NotAuthorized</span><span class="p">(</span><span class="kd">val</span> <span class="py">id</span> <span class="p">:</span> <span class="nc">UserId</span><span class="p">,</span> <span class="kd">val</span> <span class="py">message</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">AuthResult</span><span class="p">()</span>
  <span class="kd">class</span> <span class="nc">Success</span><span class="p">(</span><span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">UserId</span><span class="p">,</span> <span class="kd">val</span> <span class="py">token</span> <span class="p">:</span> <span class="nc">MagicToken</span><span class="p">)</span> <span class="p">:</span> <span class="nc">AuthResult</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">proceed</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="nc">AuthResult</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">is</span> <span class="nc">NotAuthenticated</span> <span class="p">-&gt;</span> <span class="s">"NotAuthenticated ${r.message}"</span>
  <span class="k">is</span> <span class="nc">NotAuthorized</span> <span class="p">-&gt;</span> <span class="s">"NotAuthorized ${r.id}, ${r.message}"</span>
  <span class="k">is</span> <span class="nc">Success</span> <span class="p">-&gt;</span> <span class="s">"Success ${r.token}"</span>
<span class="p">}</span></code></pre></figure>

<p>In this example we also need not specify <code class="language-plaintext highlighter-rouge">else</code> case for 
<a href="https://kotlinlang.org/docs/reference/control-flow.html#when-expression">when expression</a>.
Kotlin compiler is able to prove we listed all types if this sealed class.</p>

<p>Thanks to <a href="https://kotlinlang.org/docs/reference/typecasts.html#smart-casts">smart casts</a> 
in each <code class="language-plaintext highlighter-rouge">when</code> branch we use exactly matched type, so for example, <code class="language-plaintext highlighter-rouge">r.message</code> in the first branch 
is <code class="language-plaintext highlighter-rouge">NotAuthenticated#message</code> and so on.</p>

<h1 id="generated-bytecode">Generated bytecode</h1>

<p>Let’s traditionally take a look into bytecode, that was generated from this code snippet. 
Note. I use IntelliJ IDEA 2017.1 EAP with Kotlin 1.0.6 plugin. The generated bytecode 
may change with a future version of tools.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">  // access flags 0x19
  public final static proceed(LAuthResult;)Ljava/lang/String;
    @Lorg/jetbrains/annotations/NotNull;() // invisible
    @Lorg/jetbrains/annotations/NotNull;() // invisible, parameter 0
   L0
    ALOAD 0
    LDC "r"
    INVOKESTATIC kotlin/jvm/internal/Intrinsics.checkParameterIsNotNull (Ljava/lang/Object;Ljava/lang/String;)V
   L1
    LINENUMBER 25 L1
    ALOAD 0
    ASTORE 1
   L2
    LINENUMBER 26 L2
    ALOAD 1
    INSTANCEOF AuthResult$NotAuthenticated
    IFEQ L3
   L4
    NEW java/lang/StringBuilder
    DUP
    INVOKESPECIAL java/lang/StringBuilder.&lt;init&gt; ()V
    LDC "NotAuthenticated "
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    ALOAD 0
    CHECKCAST AuthResult$NotAuthenticated
    INVOKEVIRTUAL AuthResult$NotAuthenticated.getMessage ()Ljava/lang/String;
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    INVOKEVIRTUAL java/lang/StringBuilder.toString ()Ljava/lang/String;
    GOTO L5
   L3
    LINENUMBER 27 L3
    ALOAD 1
    INSTANCEOF AuthResult$NotAuthorized
    IFEQ L6
   L7
    NEW java/lang/StringBuilder
    DUP
    INVOKESPECIAL java/lang/StringBuilder.&lt;init&gt; ()V
    LDC "NotAuthorized "
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    ALOAD 0
    CHECKCAST AuthResult$NotAuthorized
    INVOKEVIRTUAL AuthResult$NotAuthorized.getId ()LUserId;
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/Object;)Ljava/lang/StringBuilder;
    LDC ", "
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    ALOAD 0
    CHECKCAST AuthResult$NotAuthorized
    INVOKEVIRTUAL AuthResult$NotAuthorized.getMessage ()Ljava/lang/String;
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    INVOKEVIRTUAL java/lang/StringBuilder.toString ()Ljava/lang/String;
    GOTO L5
   L6
    LINENUMBER 28 L6
    ALOAD 1
    INSTANCEOF AuthResult$Success
    IFEQ L8
   L9
    NEW java/lang/StringBuilder
    DUP
    INVOKESPECIAL java/lang/StringBuilder.&lt;init&gt; ()V
    LDC "Success "
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/String;)Ljava/lang/StringBuilder;
    ALOAD 0
    CHECKCAST AuthResult$Success
    INVOKEVIRTUAL AuthResult$Success.getToken ()LMagicToken;
    INVOKEVIRTUAL java/lang/StringBuilder.append (Ljava/lang/Object;)Ljava/lang/StringBuilder;
    INVOKEVIRTUAL java/lang/StringBuilder.toString ()Ljava/lang/String;
    GOTO L5
   L8
    NEW kotlin/NoWhenBranchMatchedException
    DUP
    INVOKESPECIAL kotlin/NoWhenBranchMatchedException.&lt;init&gt; ()V
    ATHROW
   L10
    LINENUMBER 25 L10
   L5
    LINENUMBER 29 L5
    ARETURN
   L11
    LOCALVARIABLE r LAuthResult; L0 L11 0
    MAXSTACK = 2
    MAXLOCALS = 2</code></pre></figure>

<p>Kotlin compiler generated an <code class="language-plaintext highlighter-rouge">if-else</code> chain with <code class="language-plaintext highlighter-rouge">instanceof</code> checks. First it checks 
if the value is <code class="language-plaintext highlighter-rouge">AuthResult$NotAuthenticated</code>, next <code class="language-plaintext highlighter-rouge">AuthResult$NotAuthorized</code> and finally
<code class="language-plaintext highlighter-rouge">AuthResult$Success</code>. In a case something went terribly wrong, a <code class="language-plaintext highlighter-rouge">kotlin.NoWhenBranchMatchedException</code>
exception is thrown. And this can be achieved if older version of our snippet is executed with a
newer version of <code class="language-plaintext highlighter-rouge">AuthResult</code> class. A full re-compile will fail with error so we were able to 
fix the problem easily.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In this post, we looked how <code class="language-plaintext highlighter-rouge">when</code> expression is working with <code class="language-plaintext highlighter-rouge">sealed classes</code>, which are really nice
to use for cases, where one needs to return several different unrelated values.</p>

<h1 id="related-work">Related work</h1>

<p>You may also like to read a related blog post <a href="http://engineering.pivotal.io/post/algebraic-data-types-in-kotlin/">Algebraic Data Types In Kotlin</a></p>


        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2017/03/15/switch-to-when/" class="btn" title="Switch to when">Previous</a>
      
      
        <a href="/blog/2017/04/12/named-frames-v2/" class="btn" title="Hints in Stack Traces on the JVM">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>
  &copy; 2005—2026 Eugene Petrenko.
  <br />
  Unless otherwise noted, the content on the website is licensed under a
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> license.
  <br />
  Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using
  the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.
</span>
<div class="social-icons">
  <a href="https://x.com/jonnyzzz" title="Eugene Petrenko on X" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
  <a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a>
  <a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a>
  <a href="https://www.youtube.com/@jonnyzzz" title="Eugene Petrenko on YouTube" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.498 6.186a2.959 2.959 0 0 0-2.079-2.08C19.58 3.6 12 3.6 12 3.6s-7.58 0-9.419.507a2.959 2.959 0 0 0-2.08 2.079C0 8.025 0 12 0 12s0 3.975.501 5.814a2.959 2.959 0 0 0 2.08 2.079C4.42 20.4 12 20.4 12 20.4s7.58 0 9.419-.507a2.959 2.959 0 0 0 2.08-2.079C24 15.975 24 12 24 12s0-3.975-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
  <a href="/feed.xml" title="Atom/RSS feed"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script>
  // Open external links in new tab
  Array.from(document.links).forEach(link => {
    // For development: 0.0.0.0, localhost, 127.0.0.1 are all local
    const localHosts = ['localhost', '127.0.0.1', '0.0.0.0'];
    const linkIsLocal = localHosts.includes(link.hostname);
    const pageIsLocal = localHosts.includes(window.location.hostname);

    // Internal if: both are local dev hosts, or hostnames match exactly
    const isInternal = (linkIsLocal && pageIsLocal) ||
                       (link.hostname === window.location.hostname);

    if (!isInternal) {
      link.target = '_blank';
    }
  });
</script>


<!-- Google Analytics (gtag.js) -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied'
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BXXDX0ERFP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BXXDX0ERFP');
</script>
<!-- End Google Analytics -->

<!-- PostHog Analytics -->
<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init rs ls wi ns us ts ss capture calculateEventProperties vs register register_once register_for_session unregister unregister_for_session gs getFeatureFlag getFeatureFlagPayload getFeatureFlagResult isFeatureEnabled reloadFeatureFlags updateFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey cancelPendingSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException startExceptionAutocapture stopExceptionAutocapture loadToolbar get_property getSessionProperty fs ds createPersonProfile setInternalOrTestUser ps Qr opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing hs debug M cs getPageViewId captureTraceFeedback captureTraceMetric Kr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_IPtbjwwy9YIGg0YNHNxYBePijvTvHEcKAjohah6obYW', {
        api_host: 'https://us.i.posthog.com',
        defaults: '2025-11-30',
        person_profiles: 'identified_only',
    })
</script>
<!-- End PostHog Analytics -->




<!--SYNTAX HIGHLIGHTER - Lazy loads PrismJS only when code blocks are present-->
<script>
(function() {
  // Check if page has any code blocks that need highlighting
  if (!document.querySelector('pre code, code[class*="language-"]')) return;

  // Load CSS
  var cssFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.css'
  ];
  cssFiles.forEach(function(href) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  });

  // Load JS in sequence (core first, then plugins)
  var jsFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/show-language/prism-show-language.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js'
  ];

  function loadScript(index) {
    if (index >= jsFiles.length) {
      // All scripts loaded, highlight code
      if (window.Prism) Prism.highlightAll();
      return;
    }
    var script = document.createElement('script');
    script.src = jsFiles[index];
    script.onload = function() { loadScript(index + 1); };
    document.head.appendChild(script);
  }
  loadScript(0);
})();
</script>



</body>
</html>
