<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<title>Building Go Project &#8211; Eugene Petrenko</title>
<meta name="description" content="No Silver-Go-Bullet. Yet another ad-hoc build.
"/>
<meta name="keywords" content="jonnyzzz, Евгений Петренко, Eugene Petrenko, shell, bash, ci, go, build" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Building Go Project -- Eugene Petrenko" />
<meta name="twitter:description" content="No Silver-Go-Bullet. Yet another ad-hoc build.
" />
<meta name="twitter:site" content="@jonnyzzz" />
<meta name="twitter:creator" content="@jonnyzzz" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://jonnyzzz.com/images/me.jpg" />

<!-- Open Graph -->

<meta property="og:type" content="article" />
<meta property="og:image" content="https://jonnyzzz.com/images/me.jpg" />
<meta property="og:title" content="Building Go Project -- Eugene Petrenko" />
<meta property="og:description" content="No Silver-Go-Bullet. Yet another ad-hoc build.
" />
<meta property="og:url" content="https://jonnyzzz.com/blog/2017/07/05/go-build/" />
<meta property="og:site_name" content="Eugene Petrenko" />

<meta property="article:tag" content="jonnyzzz" />

<meta property="article:tag" content="Евгений Петренко" />

<meta property="article:tag" content="Eugene Petrenko" />


<meta property="article:tag" content="shell" />

<meta property="article:tag" content="bash" />

<meta property="article:tag" content="ci" />

<meta property="article:tag" content="go" />

<meta property="article:tag" content="build" />



<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="MJZCyfst2Tx4KyxbOIQu1fZyOSwA_JkQu73zJcfsl2g" />




<link rel="canonical" href="https://jonnyzzz.com/blog/2017/07/05/go-build/" />
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css" />

<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
<link rel="manifest" href="/images/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
      
		    <li><a href="/" >Home</a></li>
		  
		    <li><a href="/about/" >About</a></li>
		  
		    <li><a href="/blog/" >Blog</a></li>
		  
		    <li><a href="/projects/" >Projects</a></li>
		  
		    <li><a href="/talks/" >Talks</a></li>
		  
		    <li><a href="/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description" itemprop="description">Founding Engineering Leader | Agentic AI DevTools & Experience</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#shell" title="Pages tagged shell">shell</a></li><li><a href="/tags/#bash" title="Pages tagged bash">bash</a></li><li><a href="/tags/#ci" title="Pages tagged ci">ci</a></li><li><a href="/tags/#go" title="Pages tagged go">go</a></li><li><a href="/tags/#build" title="Pages tagged build">build</a></li>
        </ul>
        
          <h1 class="entry-title">Building Go Project</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2017-07-05T00:00:00+00:00">July 05, 2017</time></span>
        
        
        <span class="social-share-x">
  <a href="https://x.com/intent/tweet?hashtags=shell,bash,ci,go,build&amp;text=Building%20Go%20Project&amp;url=https://jonnyzzz.com/blog/2017/07/05/go-build/&amp;via=jonnyzzz" title="Share on X" itemprop="X" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg> Post</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://jonnyzzz.com/blog/2017/07/05/go-build/" title="Share on Facebook" itemprop="Facebook" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg> Like</a>
</span>
<!-- /.social-share -->

      </footer>
      <div class="entry-content">
        <p>No Silver-Go-Bullet. Yet another ad-hoc build.</p>

<p>I was doing a small Go command line tool project. All the time I was starting Go codebase, I looking for 
the proper way to setup project and to build it.</p>

<p>The right build to me is the build which is reproducible. Such build is likely to be isolated 
from a machine where you run it. Be it Linux, Mac or Windows. 
Also, the right build should have all dependencies fixed. Otherwise, we have merely no chances
to recreated it in the future.</p>

<p>As the very first example, I decided to use the approach from <a href="https://github.com/hashicorp/consul-template">Consul Template</a>.
That time (May 2017) it was a <code class="language-plaintext highlighter-rouge">make</code> based build which was using the official Docker container to run.
It was great! I was able to kick-start the project and to focus on development. But, it was crazy slow. 
It took seconds to compile a tiny project. It was also unable to run on Windows.</p>

<p>I did research. Found several approaches to building Go with Gradle. I decided to try 
<a href="https://github.com/gogradle/gogradle">Gogradle</a>. Also, there is <a href="https://github.com/echocat/gradle-golang-plugin">gradle-golang-plugin</a>.
Overall, the story did not play well because some issues I came across. And again, the solution was heavy!</p>

<p>Isolation. Docker. Cool stuff. But, the best stuff, it to think Docker, and event avoid it. The Go itself 
is amazing in that sense. The go binaries have zero dependencies. And this means we are able to zero-copy
dependencies.</p>

<p>Finally, I created the following script. A still waiting for something better, and easier to use.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span> <span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span> <span class="nb">dirname</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="si">)</span><span class="s2">"</span>
<span class="nb">set</span> <span class="nt">-e</span> <span class="nt">-x</span> <span class="nt">-u</span>

<span class="nv">GOVERSION</span><span class="o">=</span>1.8.1

<span class="nv">LOCAL_DIST</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">/dist"</span>
<span class="nv">LOCAL_GO_HOME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LOCAL_DIST</span><span class="s2">/go-</span><span class="si">$(</span><span class="nb">uname</span><span class="si">)</span><span class="s2">-</span><span class="nv">$GOVERSION</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="nv">$LOCAL_GO_HOME</span>/bin/go <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">GO_PKG</span><span class="o">=</span><span class="nv">$LOCAL_DIST</span>/go-pkg-<span class="nv">$GOVERSION</span>/go-binary.tar.gz
  <span class="nv">GO_UNPACK</span><span class="o">=</span><span class="nv">$LOCAL_DIST</span>/go-pkg-<span class="nv">$GOVERSION</span>/unpack

  <span class="nb">rm</span> <span class="nt">-rf</span>   <span class="nv">$GO_UNPACK</span> <span class="o">||</span> <span class="nb">true
  mkdir</span> <span class="nt">-p</span> <span class="nv">$GO_UNPACK</span> <span class="o">||</span> <span class="nb">true

  </span><span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="si">$(</span> <span class="nb">uname</span> <span class="si">)</span><span class="s2">"</span> <span class="o">=</span>~ .<span class="k">*</span><span class="o">[</span>Dd]arwin.<span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span>curl <span class="nt">-o</span> <span class="nv">$GO_PKG</span> https://storage.googleapis.com/golang/go<span class="k">${</span><span class="nv">GOVERSION</span><span class="k">}</span>.darwin-amd64.tar.gz
  <span class="k">else
    </span>curl <span class="nt">-o</span> <span class="nv">$GO_PKG</span> https://storage.googleapis.com/golang/go<span class="k">${</span><span class="nv">GOVERSION</span><span class="k">}</span>.linux-amd64.tar.gz
  <span class="k">fi

  </span><span class="nb">tar</span> <span class="nt">-xf</span> <span class="nv">$GO_PKG</span> <span class="nt">-C</span> <span class="nv">$GO_UNPACK</span>

  <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$LOCAL_GO_HOME</span> <span class="o">||</span> <span class="nb">true
  mkdir</span> <span class="nt">-p</span> <span class="nv">$LOCAL_GO_HOME</span> <span class="o">||</span> <span class="nb">true
  mv</span> <span class="nv">$GO_UNPACK</span>/go/<span class="k">**</span> <span class="nv">$LOCAL_GO_HOME</span>/

  <span class="nb">rm</span> <span class="nt">-f</span> <span class="nv">$GO_PKG</span>
<span class="k">fi

</span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LOCAL_GO_HOME</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nv">GOROOT</span><span class="o">=</span><span class="nv">$LOCAL_GO_HOME</span>
<span class="nv">GOPATH</span><span class="o">=</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>

<span class="nb">export </span>PATH
<span class="nb">export </span>GOROOT
<span class="nb">export </span>GOPATH
<span class="nb">export </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0

<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="si">$(</span>which go<span class="si">)</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$LOCAL_GO_HOME</span><span class="s2">/bin/go"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Incorrect go binary is still used: </span><span class="si">$(</span>which go<span class="si">)</span><span class="s2">"</span>
  <span class="nb">exit </span>1
<span class="k">fi

if</span> <span class="o">[[</span> <span class="o">!</span> <span class="s2">"</span><span class="si">$(</span>go version<span class="si">)</span><span class="s2">"</span> <span class="o">=</span>~ <span class="s2">"go</span><span class="k">${</span><span class="nv">GOVERSION</span><span class="k">}</span><span class="s2"> "</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Failed to install required Go version. "</span>
  <span class="nb">exit </span>1
<span class="k">fi</span></code></pre></figure>

<p>The script downloads Go binaries for Mac or Linux to a build folder. It does not update the folder if
there is Go already.</p>

<p>You may find the actual version on GitHub. <a href="https://github.com/jonnyzzz/go-build-script">https://github.com/jonnyzzz/go-build-script</a>
And let me know if you know the better way to Go.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2017/06/21/coroutine-to-process-data/" class="btn" title="A Kotlin Coroutine for an OutputStream Filtering">Previous</a>
      
      
        <a href="/blog/2017/08/09/test-runner/" class="btn" title="A Bash Test Runner for TeamCity">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>
  &copy; 2005—2026 Eugene Petrenko.
  <br />
  Unless otherwise noted, the content on the website is licensed under a
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> license.
  <br />
  Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using
  the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.
</span>
<div class="social-icons">
  <a href="https://x.com/jonnyzzz" title="Eugene Petrenko on X" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
  <a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a>
  <a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a>
  <a href="https://www.youtube.com/channel/UC9Q18kLRzcJ1xtOJ3GGvxBw" title="Eugene Petrenko on YouTube" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.498 6.186a2.959 2.959 0 0 0-2.079-2.08C19.58 3.6 12 3.6 12 3.6s-7.58 0-9.419.507a2.959 2.959 0 0 0-2.08 2.079C0 8.025 0 12 0 12s0 3.975.501 5.814a2.959 2.959 0 0 0 2.08 2.079C4.42 20.4 12 20.4 12 20.4s7.58 0 9.419-.507a2.959 2.959 0 0 0 2.08-2.079C24 15.975 24 12 24 12s0-3.975-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
  <a href="/feed.xml" title="Atom/RSS feed"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script>
  // Open external links in new tab
  Array.from(document.links).forEach(link => {
    // For development: 0.0.0.0, localhost, 127.0.0.1 are all local
    const localHosts = ['localhost', '127.0.0.1', '0.0.0.0'];
    const linkIsLocal = localHosts.includes(link.hostname);
    const pageIsLocal = localHosts.includes(window.location.hostname);

    // Internal if: both are local dev hosts, or hostnames match exactly
    const isInternal = (linkIsLocal && pageIsLocal) ||
                       (link.hostname === window.location.hostname);

    if (!isInternal) {
      link.target = '_blank';
    }
  });
</script>


<!-- Google Analytics (gtag.js) -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied'
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BXXDX0ERFP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BXXDX0ERFP');
</script>
<!-- End Google Analytics -->




<!--SYNTAX HIGHLIGHTER - Lazy loads PrismJS only when code blocks are present-->
<script>
(function() {
  // Check if page has any code blocks that need highlighting
  if (!document.querySelector('pre code, code[class*="language-"]')) return;

  // Load CSS
  var cssFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.css'
  ];
  cssFiles.forEach(function(href) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  });

  // Load JS in sequence (core first, then plugins)
  var jsFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/show-language/prism-show-language.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js'
  ];

  function loadScript(index) {
    if (index >= jsFiles.length) {
      // All scripts loaded, highlight code
      if (window.Prism) Prism.highlightAll();
      return;
    }
    var script = document.createElement('script');
    script.src = jsFiles[index];
    script.onload = function() { loadScript(index + 1); };
    document.head.appendChild(script);
  }
  loadScript(0);
})();
</script>



</body>
</html>
