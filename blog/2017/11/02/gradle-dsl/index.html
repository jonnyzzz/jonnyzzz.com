<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<title>Kotlin DSL for Test Data &#8211; Eugene Petrenko</title>
<meta name="description" content="Kotlin DSLs can be used to replace a boring test data strings with correct and an easy to read a code.
"/>
<meta name="keywords" content="jonnyzzz, Евгений Петренко, Eugene Petrenko, gradle, java9, opensource, plugin, java9c, kotlin, dsl" />


<!-- Twitter Cards -->
<meta name="twitter:title" content="Kotlin DSL for Test Data -- Eugene Petrenko" />
<meta name="twitter:description" content="Kotlin DSLs can be used to replace a boring test data strings with correct and an easy to read a code.
" />
<meta name="twitter:site" content="@jonnyzzz" />
<meta name="twitter:creator" content="@jonnyzzz" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://jonnyzzz.com/images/me.jpg" />

<!-- Open Graph -->

<meta property="og:type" content="article" />
<meta property="og:image" content="https://jonnyzzz.com/images/me.jpg" />
<meta property="og:title" content="Kotlin DSL for Test Data -- Eugene Petrenko" />
<meta property="og:description" content="Kotlin DSLs can be used to replace a boring test data strings with correct and an easy to read a code.
" />
<meta property="og:url" content="https://jonnyzzz.com/blog/2017/11/02/gradle-dsl/" />
<meta property="og:site_name" content="Eugene Petrenko" />

<meta property="article:tag" content="jonnyzzz" />

<meta property="article:tag" content="Евгений Петренко" />

<meta property="article:tag" content="Eugene Petrenko" />


<meta property="article:tag" content="gradle" />

<meta property="article:tag" content="java9" />

<meta property="article:tag" content="opensource" />

<meta property="article:tag" content="plugin" />

<meta property="article:tag" content="java9c" />

<meta property="article:tag" content="kotlin" />

<meta property="article:tag" content="dsl" />



<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="MJZCyfst2Tx4KyxbOIQu1fZyOSwA_JkQu73zJcfsl2g" />




<link rel="canonical" href="https://jonnyzzz.com/blog/2017/11/02/gradle-dsl/" />
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css" />

<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
<link rel="manifest" href="/images/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
      
		    <li><a href="/" >Home</a></li>
		  
		    <li><a href="/about/" >About</a></li>
		  
		    <li><a href="/blog/" >Blog</a></li>
		  
		    <li><a href="/projects/" >Projects</a></li>
		  
		    <li><a href="/talks/" >Talks</a></li>
		  
		    <li><a href="/tags/" >Tags</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description" itemprop="description">Founding Engineering Leader | Agentic AI DevTools & Experience</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#gradle" title="Pages tagged gradle">gradle</a></li><li><a href="/tags/#java9" title="Pages tagged java9">java9</a></li><li><a href="/tags/#opensource" title="Pages tagged opensource">opensource</a></li><li><a href="/tags/#plugin" title="Pages tagged plugin">plugin</a></li><li><a href="/tags/#java9c" title="Pages tagged java9c">java9c</a></li><li><a href="/tags/#kotlin" title="Pages tagged kotlin">kotlin</a></li><li><a href="/tags/#dsl" title="Pages tagged dsl">dsl</a></li>
        </ul>
        
          <h1 class="entry-title">Kotlin DSL for Test Data</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2017-11-02T00:00:00+00:00">November 02, 2017</time></span>
        
        
        <span class="social-share-x">
  <a href="https://x.com/intent/tweet?hashtags=gradle,java9,opensource,plugin,java9c,kotlin,dsl&amp;text=Kotlin%20DSL%20for%20Test%20Data&amp;url=https://jonnyzzz.com/blog/2017/11/02/gradle-dsl/&amp;via=jonnyzzz" title="Share on X" itemprop="X" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg> Post</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://jonnyzzz.com/blog/2017/11/02/gradle-dsl/" title="Share on Facebook" itemprop="Facebook" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14" style="vertical-align: middle; fill: currentColor;"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg> Like</a>
</span>
<!-- /.social-share -->

      </footer>
      <div class="entry-content">
        <p>Kotlin DSLs can be used to replace a boring test data strings with correct and an easy to read a code.</p>

<p>That time I was working on <a href="/blog/2017/10/18/java9c/">java9c</a> plugin for Gradle, I created
integration tests. In my case all those tests were of the following pattern: create sample Gradle
project, execute it, check results. I decided to run a fun experiment and replace boring string
constants with a Gradle-looking DSL.</p>

<p>Namely, instead of (and many Gradle plugin integration tests have similar)</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="nf">generateDSL</span><span class="p">(</span>
        <span class="s">"apply plugin: 'java-library'\n"</span> <span class="p">+</span>
        <span class="s">"repositories {\n"</span> <span class="p">+</span>
        <span class="s">"  mavenCentral()\n"</span> <span class="p">+</span>
        <span class="s">"}\n"</span> <span class="p">+</span>
        <span class="s">"\n"</span> <span class="p">+</span>
        <span class="s">"dependencies {\n"</span> <span class="p">+</span>
        <span class="s">"  implementation 'junit:junit:4.12'\n"</span> <span class="p">+</span>
        <span class="s">"}\n"</span>
<span class="p">)</span></code></pre></figure>

<p>I created a tiny DSL that looks (and parses) like a Gradle script. 
The DSL generates test-data files for me. Kotlin compiler and IDE 
helps to prevent errors before a test is executed. Code completion 
makes a new test authoring easier. Here is the DSL usage example:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="nf">generateDSL</span> <span class="p">{</span>
  <span class="n">`apply</span> <span class="nf">plugin`</span><span class="p">(</span><span class="s">"java-library"</span><span class="p">)</span>

  <span class="nf">repositories</span> <span class="p">{</span>
    <span class="nf">mavenCentral</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nf">dependencies</span> <span class="p">{</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="nc">Text</span><span class="p">(</span><span class="s">"junit:junit:4.12"</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>More examples are on <a href="https://github.com/jonnyzzz/gradle-java9c">GitHub</a> in <code class="language-plaintext highlighter-rouge">java9c</code> plugin test sources.</p>

<p>The example looks like a Gradle script. There was no goal to make it 100% same looking. Also, 
there is an amazing <a href="https://github.com/gradle/kotlin-dsl">project</a> run by Gradle to support
Kotlin DSLs in Gradle, natively. That DSL is not 100% same looking to a Gradle-Groovy scripts too.</p>

<p>The implementation of that my magic DSL fits in 
<a href="https://github.com/jonnyzzz/gradle-java9c/blob/master/test-common/src/main/java/org/jonnyzzz/gradle/java9c/files.kt">one file</a>,
and it’s about 150 lines.</p>

<p>Next, I’ll explain how one can create similar DSLs for their own needs. With Kotlin you may target 
JVM, Android, JS, and Native, reusing same pure-Kotlin code.</p>

<h1 id="dsl-basics">DSL Basics</h1>

<p>We need to create a text generator DSL. The primary decision if either to generate a bare text or to use an API of a library. 
You may consider <a href="https://www.w3.org/DOM/">XML DOM</a> or <a href="https://github.com/FasterXML/jackson">Jackson</a>. 
There are <a href="https://github.com/square/kotlinpoet">kotlinpoet</a> or <a href="https://github.com/square/javapoet">javapoet</a>
to generate Kotlin or Java code via an API. I bet there are many other libraries. 
<a href="https://github.com/nebula-plugins/gradle-lint-plugin">Nebula Gradle Lint Plugin</a> can read/write 
Gradle scripts too.</p>

<p>There is a trade-off. Dealing with a library may be complicated and time-consuming, but way more stable.</p>

<p>For the sake of <a href="/blog/2017/10/18/java9c/">java9c</a> tests, I decided to implement the generator 
based on bare text output. And it’d be me who covers all risks and bugs from the implementation. 
It is only about 150 lines (now) of 
<a href="https://github.com/jonnyzzz/gradle-java9c/blob/master/test-common/src/main/java/org/jonnyzzz/gradle/java9c/files.kt">code</a>.</p>

<h2 id="writer-interface">Writer Interface</h2>

<p>I started with a line writer interface:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">interface</span> <span class="nc">LineWriter</span> <span class="p">{</span>
  <span class="k">operator</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">unaryMinus</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure>

<p>Inside the interface, I use unary minus, e.g., <code class="language-plaintext highlighter-rouge">-"foo"</code> as the function to write a line. It reads better in DSLs, e.g.</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">lineWriter</span><span class="p">.</span><span class="nf">apply</span> <span class="p">{</span>
  <span class="p">-</span><span class="s">"line of text"</span>
<span class="p">}</span></code></pre></figure>

<p>Well, you may decide to have a <code class="language-plaintext highlighter-rouge">fun line(text: String)</code> instead. That does not change the rest, so, please
feel free to use a function instead of an operator. Alternatively, you may use <code class="language-plaintext highlighter-rouge">String.unaryPlus</code>, so that
you’d have <code class="language-plaintext highlighter-rouge">+"foo"</code>.</p>

<p>See <a href="https://kotlinlang.org/docs/reference/operator-overloading.html">Operator Overloading</a> documentation
or ask me, if you need to clarify the trick.</p>

<h2 id="a-trivial-writer-implementation">A Trivial Writer Implementation</h2>

<p>The implementation of the interface could be something trivial, e.g.</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">fun</span> <span class="nf">generateDSL</span><span class="p">(</span><span class="n">builder</span><span class="p">:</span> <span class="nc">LineWriter</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">:</span> <span class="nc">String</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">StringBuilder</span><span class="p">()</span>
  <span class="kd">object</span> <span class="err">: </span><span class="nc">LineWriter</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">unaryMinis</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">result</span><span class="p">.</span><span class="nf">appendln</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nf">builder</span><span class="p">()</span> 
  <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span> 
<span class="p">}</span></code></pre></figure>

<p>The usage could be:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">val</span> <span class="py">text</span> <span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="nf">generateDSL</span> <span class="p">{</span>
  <span class="p">-</span><span class="s">"line of text"</span>
<span class="p">}</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">generateDSL</code> receives a <a href="https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver">lambda with receiver</a>
and returns resulting string. It is the implementation detail to pass the instance of 
<code class="language-plaintext highlighter-rouge">LineWriter</code> to the lambda. Inside the lambda, the receiver is <code class="language-plaintext highlighter-rouge">LineWriter</code>, it means, that <code class="language-plaintext highlighter-rouge">this</code> keyword 
resolves to an instance of <code class="language-plaintext highlighter-rouge">LineWriter</code>. Of course, <code class="language-plaintext highlighter-rouge">this.</code> can be omitted and all methods are resolved
against <code class="language-plaintext highlighter-rouge">LineWriter</code> instance. It follows that <code class="language-plaintext highlighter-rouge">- "foo"</code> calls resolves to <code class="language-plaintext highlighter-rouge">String.unaryMinus()</code> function
of <code class="language-plaintext highlighter-rouge">LineWriter</code> inside the lambda scope.</p>

<p>For short, we may compact the <code class="language-plaintext highlighter-rouge">generateDSL</code> function to the following:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">fun</span> <span class="nf">generateDSL</span><span class="p">(</span><span class="n">builder</span><span class="p">:</span> <span class="nc">LineWriter</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">=</span> <span class="nf">buildString</span> <span class="p">{</span>
  <span class="kd">object</span> <span class="err">: </span><span class="nc">LineWriter</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">unaryMinis</span><span class="p">()</span> <span class="p">{</span>
       <span class="nf">appendln</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nf">builder</span><span class="p">()</span>  
<span class="p">}</span></code></pre></figure>

<p>Here I use a <code class="language-plaintext highlighter-rouge">fun buildString(builderAction: StringBuilder.() -&gt; Unit): String</code> function from the Kotlin standard library. 
It receives yet another <a href="https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver">lambda with receiver</a> 
on <code class="language-plaintext highlighter-rouge">StringBuilder</code> type so that <code class="language-plaintext highlighter-rouge">appendln</code> is a function from it.</p>

<p>Theoretically, you may have several different entry point functions (e.g., <code class="language-plaintext highlighter-rouge">generateDSL</code>)
to, say, generate a string, a file or something else. The rest does not depend on a particular 
<code class="language-plaintext highlighter-rouge">generate*</code> function.</p>

<h1 id="indenting-and-blocks">Indenting and Blocks</h1>

<p>Text generation for languages like Gradle requires indenting. We have blocks, and it’s nice
to simplify blocks generation. At first, I created an <code class="language-plaintext highlighter-rouge">offset</code> function for it:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">fun</span> <span class="nc">LineWriter</span><span class="p">.</span><span class="nf">offset</span><span class="p">():</span> <span class="nc">LineWriter</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">outer</span> <span class="p">=</span> <span class="k">this</span>
  <span class="k">return</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">LineWriter</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">unaryMinus</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">s</span> <span class="p">=</span> <span class="k">this</span>
      <span class="n">outer</span><span class="p">.</span><span class="nf">apply</span> <span class="p">{</span> 
        <span class="p">-(</span><span class="s">"  "</span> <span class="p">+</span> <span class="n">s</span><span class="p">)</span> 
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The function is an <a href="https://kotlinlang.org/docs/reference/extensions.html">extension function</a>. It makes
no need to change the original <code class="language-plaintext highlighter-rouge">LineWriter</code> interface, but it still reads as a method call.</p>

<p>The <code class="language-plaintext highlighter-rouge">block</code> function is as follows:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">fun</span> <span class="nc">LineWriter</span><span class="p">.</span><span class="nf">block</span><span class="p">(</span><span class="n">name</span> <span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="nc">LineWriter</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">-</span><span class="s">"$name {"</span>
  <span class="nf">offset</span><span class="p">().</span><span class="nf">builder</span><span class="p">()</span>
  <span class="p">-</span><span class="s">"}"</span>
  <span class="p">-</span><span class="s">""</span>
<span class="p">}</span></code></pre></figure>

<p>Here I use <a href="https://kotlinlang.org/docs/reference/idioms.html#string-interpolation">string interpolation</a>
to simplify code of the first line.</p>

<p>At that point I can write the DSL snippets like that:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="nf">generateDSL</span> <span class="p">{</span>
  <span class="nf">block</span><span class="p">(</span><span class="s">"jonnyzzz"</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">-</span><span class="s">"test"</span>
  <span class="p">}</span>
<span class="p">}</span>  </code></pre></figure>

<p>And it yields</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">jonnyzzz {
  test
}  </code></pre></figure>

<p>Nice, isn’t it?</p>

<h1 id="gradle-specific-constructs">Gradle Specific Constructs</h1>

<p>With <code class="language-plaintext highlighter-rouge">block</code> function one can create all necessary functions to generate blocks like <code class="language-plaintext highlighter-rouge">repositories</code>, <code class="language-plaintext highlighter-rouge">dependencies</code> and so on. 
Now it is time to implement specific parts of the DSL and allow some constructs only inside other constructs.</p>

<h2 id="repositories">Repositories</h2>

<p>Let’s consider <code class="language-plaintext highlighter-rouge">repositories</code> block. Inside we have pre-defined functions for <code class="language-plaintext highlighter-rouge">mavenCentral()</code> and <code class="language-plaintext highlighter-rouge">jcenter()</code>.</p>

<p>First, we need a builder interface and implementation. It can be done as follows:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">interface RepositoriesWriter : LineWriter {
  fun mavenCentral() { -"mavenCentral()" }
  fun mavenLocal() { -"mavenLocal()" }
  fun jcenter() { -"jcenter()" }
}

fun RepositoriesHolder.repositories(builder: RepositoriesWriter.() -&gt; Unit) =
        block("repositories") {
          object : RepositoriesWriter, LineWriter by it {
          }.builder()
        }</code></pre></figure>

<p>We define an interface <code class="language-plaintext highlighter-rouge">RepositoriesWriter</code> to play as the scope of the generation. In the interface,
we have <code class="language-plaintext highlighter-rouge">mavenLocal</code> and other functions with trivial implementations. Those functions can be alternatively 
implemented as extension functions of inside the <code class="language-plaintext highlighter-rouge">repositories</code> function. That is up to the author.</p>

<p>In the <code class="language-plaintext highlighter-rouge">repositories</code> function, I use <a href="https://kotlinlang.org/docs/reference/delegation.html">class delegation</a> aka <code class="language-plaintext highlighter-rouge">by</code>
keyword to implement <code class="language-plaintext highlighter-rouge">LineWriter</code> from <code class="language-plaintext highlighter-rouge">RepositoriesWriter</code> to delegate to another instance of <code class="language-plaintext highlighter-rouge">LineWriter</code>. 
So short to write and powerful!</p>

<p>As the result, we can have</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">generateDSL {
  repositories {
     mavenCentral()
     -"// another line"
  }
}   </code></pre></figure>

<p>The same way I created the whole bunch of functions to support the subset of Gradle scripts I 
was using in my tests. You may take a look 
<a href="https://github.com/jonnyzzz/gradle-java9c/blob/master/test/src/test/java/org/jonnyzzz/gradle/java9c/test-4.2.1.kt">here for more details</a>.</p>

<h2 id="specific-dsl-alternatives">Specific DSL Alternatives</h2>

<p>It was another design decision to allow <code class="language-plaintext highlighter-rouge">LineWriter</code> functions and extension functions (e.g., <code class="language-plaintext highlighter-rouge">block</code>) 
of the scope of <code class="language-plaintext highlighter-rouge">RepositoriesWriter</code> lambda. We might have decided opposite. In the case, we would need
<a href="https://kotlinlang.org/docs/reference/type-safe-builders.html#scope-control-dslmarker-since-11">DslMarker</a>
annotation to make sure <code class="language-plaintext highlighter-rouge">LineWriter</code> functions and extension functions are not resolved to the 
outer scope. We probably have a <code class="language-plaintext highlighter-rouge">generateDSL</code> function call on the top.</p>

<h1 id="wrapping-up">Wrapping Up</h1>

<p>DSLs are nice. In the post, I presented the DSL building pattern. 
Use it to create your DSLs. Ask me if you have questions. 
You may also check <a href="https://kotlinlang.org/docs/reference/type-safe-builders.html">this</a> article from Kotlin 
documentation or <a href="https://www.youtube.com/watch?v=BnTtjywqAX8">a video of a talk by Hadi</a>.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2017/10/18/java9c/" class="btn" title="A Gradle Plugin to Detect Package Conflicts for Migration to Java 9 Modules">Previous</a>
      
      
        <a href="/blog/2017/12/04/macos-keys/" class="btn" title="MacBook Fix Tilde Key">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>
  &copy; 2005—2026 Eugene Petrenko.
  <br />
  Unless otherwise noted, the content on the website is licensed under a
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> license.
  <br />
  Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using
  the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.
</span>
<div class="social-icons">
  <a href="https://x.com/jonnyzzz" title="Eugene Petrenko on X" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
  <a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg></a>
  <a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a>
  <a href="https://www.youtube.com/channel/UC9Q18kLRzcJ1xtOJ3GGvxBw" title="Eugene Petrenko on YouTube" target="_blank"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.498 6.186a2.959 2.959 0 0 0-2.079-2.08C19.58 3.6 12 3.6 12 3.6s-7.58 0-9.419.507a2.959 2.959 0 0 0-2.08 2.079C0 8.025 0 12 0 12s0 3.975.501 5.814a2.959 2.959 0 0 0 2.08 2.079C4.42 20.4 12 20.4 12 20.4s7.58 0 9.419-.507a2.959 2.959 0 0 0 2.08-2.079C24 15.975 24 12 24 12s0-3.975-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
  <a href="/feed.xml" title="Atom/RSS feed"><svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script>
  // Open external links in new tab
  Array.from(document.links).forEach(link => {
    // For development: 0.0.0.0, localhost, 127.0.0.1 are all local
    const localHosts = ['localhost', '127.0.0.1', '0.0.0.0'];
    const linkIsLocal = localHosts.includes(link.hostname);
    const pageIsLocal = localHosts.includes(window.location.hostname);

    // Internal if: both are local dev hosts, or hostnames match exactly
    const isInternal = (linkIsLocal && pageIsLocal) ||
                       (link.hostname === window.location.hostname);

    if (!isInternal) {
      link.target = '_blank';
    }
  });
</script>


<!-- Google Analytics (gtag.js) -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'analytics_storage': 'denied'
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BXXDX0ERFP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BXXDX0ERFP');
</script>
<!-- End Google Analytics -->




<!--SYNTAX HIGHLIGHTER - Lazy loads PrismJS only when code blocks are present-->
<script>
(function() {
  // Check if page has any code blocks that need highlighting
  if (!document.querySelector('pre code, code[class*="language-"]')) return;

  // Load CSS
  var cssFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.css',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.css'
  ];
  cssFiles.forEach(function(href) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  });

  // Load JS in sequence (core first, then plugins)
  var jsFiles = [
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/line-numbers/prism-line-numbers.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/toolbar/prism-toolbar.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/show-language/prism-show-language.min.js',
    'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js'
  ];

  function loadScript(index) {
    if (index >= jsFiles.length) {
      // All scripts loaded, highlight code
      if (window.Prism) Prism.highlightAll();
      return;
    }
    var script = document.createElement('script');
    script.src = jsFiles[index];
    script.onload = function() { loadScript(index + 1); };
    document.head.appendChild(script);
  }
  loadScript(0);
})();
</script>



</body>
</html>
