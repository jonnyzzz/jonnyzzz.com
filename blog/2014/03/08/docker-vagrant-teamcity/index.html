<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Docker Vagrant TeamCity &#8211; Eugene Petrenko</title>

<meta name="keywords" content="free-time, teamcity runner, plugin, opensource, teamcity plugin, openapi, teamcity, teamcity api, build, feature, TeamCity.Virtual">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Docker Vagrant TeamCity">

<meta name="twitter:site" content="@jonnyzzz">
<meta name="twitter:creator" content="@jonnyzzz">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Vagrant TeamCity">

<meta property="og:url" content="/blog/2014/03/08/docker-vagrant-teamcity/">
<meta property="og:site_name" content="Eugene Petrenko">





<link rel="canonical" href="/blog/2014/03/08/docker-vagrant-teamcity/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Eugene Petrenko Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="/assets/js/vendor/html5shiv.min.js"></script>
  <script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/images/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"light-bottom"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->


<!--SYNTAX HIGHLIGHTER BEGINS-->

<script src="/assets/syntax/syntax.js"></script>

<link rel="stylesheet" href="/assets/syntax/syntax.css" />

<!--SYNTAX HIGHLIGHTER ENDS-->


</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="/blog/" >Blog</a></li>
		  
		    
		        
		    
		    <li><a href="/projects/" >Projects</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Eugene @jonnyzzz Petrenko personal page and blog</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#free-time" title="Pages tagged free-time">free-time</a></li><li><a href="/tags/#teamcity runner" title="Pages tagged teamcity runner">teamcity runner</a></li><li><a href="/tags/#plugin" title="Pages tagged plugin">plugin</a></li><li><a href="/tags/#opensource" title="Pages tagged opensource">opensource</a></li><li><a href="/tags/#teamcity plugin" title="Pages tagged teamcity plugin">teamcity plugin</a></li><li><a href="/tags/#openapi" title="Pages tagged openapi">openapi</a></li><li><a href="/tags/#teamcity" title="Pages tagged teamcity">teamcity</a></li><li><a href="/tags/#teamcity api" title="Pages tagged teamcity api">teamcity api</a></li><li><a href="/tags/#build" title="Pages tagged build">build</a></li><li><a href="/tags/#feature" title="Pages tagged feature">feature</a></li><li><a href="/tags/#TeamCity.Virtual" title="Pages tagged TeamCity.Virtual">TeamCity.Virtual</a></li>
        </ul>
        
          <h1 class="entry-title">Docker Vagrant TeamCity</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2014-03-08T15:00:00+01:00"><i class="fa fa-calendar-o"></i> March 08, 2014</time></span>
        <span class="entry-date date modified"><time datetime="2014-03-09T10:22:30.005+01:00"><i class="fa fa-pencil"></i> March 09, 2014</time></span>
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>In this post I'll introduce the brand new <a
  href="https://github.com/jonnyzzz/TeamCity.Virtual">TeamCity.Virtual</a> plugin that supports execution
  under virtual environments from <a href="http://www.vagrantup.com/">Vagrant</a> or <a
    href="https://www.docker.io/">Docker</a></p> <h2>Software is the problem</h2><p>Every
  build running under CI requires some software/libraries/JVMs/* to be pre-configured on the machine. When your
  setup has only one build agent everything is simple. But if you need an easy recreatable environment things get
  more complicated. Every time you need to install some software on every build agent you have to do lots of routine
  work. When there is a pool of build machines its getting overcomplicated</p><p>There exists at least
  one way to cope with this complexity. Virtual machines. LinuX Containers. Thanks to <a
    href="http://www.vagrantup.com/">Vagrant</a> it became an easy, repeatable and scriptable solution. With
  <a href="http://en.wikipedia.org/wiki/LXC">LinuX Containers</a> (for example <a
    href="https://www.docker.io/">Docker</a>) things are even faster <p><a
  href="https://github.com/jonnyzzz/TeamCity.Virtual">TeamCity.Virtual</a> plugin makes using <a
  href="https://www.docker.io/">Docker</a> and <a href="http://www.vagrantup.com/">Vagrant</a>
  in TeamCity as easy as using a build runner. So for example, you may run your <a href="http://nodejs.org/">nodejs</a>
  builds in a fresh environment of required version without any extra per-agent pre-configuration work</p>
<h2><a href="https://github.com/jonnyzzz/TeamCity.Virtual">TeamCity.Virtual</a> plugin</h2><p>The
  build runner is called <strong>Docker / Vagrant</strong>. On the runner settings page you may specify
  the virtual environment configuration to start and the script to execute inside it:</p>
<div><a
  style="float:left;"
  href="http://3.bp.blogspot.com/-Q586fZBelDU/UxoOzV-POBI/AAAAAAAAE_U/uDOOmgwDHk0/s1600/Screenshot+2014-03-07+22.23.46.png"
  imageanchor="1"><img border="0" alt="Vagrant"
                       src="http://3.bp.blogspot.com/-Q586fZBelDU/UxoOzV-POBI/AAAAAAAAE_U/uDOOmgwDHk0/s320/Screenshot+2014-03-07+22.23.46.png"
/></a>

  <div style="width:2em;float:left;">&nbsp;</div>
  <a style="float:left;"
     href="http://2.bp.blogspot.com/-EEzlusoUZiY/UxsdSqBJIlI/AAAAAAAAE_0/f8oeCNkG_l0/s1600/Screenshot+2014-03-08+17.38.00.png"
     imageanchor="1"><img border="0" alt="Docker"
                          src="http://2.bp.blogspot.com/-EEzlusoUZiY/UxsdSqBJIlI/AAAAAAAAE_0/f8oeCNkG_l0/s320/Screenshot+2014-03-08+17.38.00.png"
  /></a></div>
<div style="clear:both"></div> <h2>Implementation Details</h2><p>The
  plugin works as follows:</p>
<ul>
  <li> The plugin detects the installed on the build agent <em>Vagrant</em>
    and/or <em>Docker</em> (so only compatible build agents will be used)
  </li>
  <li> It starts
    the virtual environment (box/container) on the build agent
  </li>
  <li> Mounts the build checkout
    directory into the started machine
  </li>
  <li> Maps the working directory into machines path</li>
  <li>
    Executes the provided script in the started virtual environment in the working directory
  </li>
  <li>
    Destroys the environment wiping all the state
  </li>
</ul> <h3>Settings</h3><p>Vagrant
  box is specified via <em>Vagrantfile</em>. For <em>Docker</em> you need to specify image
  name only</p> <h2>Run experiments</h2><p>This is what you see in the build log of <em>Vagrant</em>
  VM command:</p><a
  href="http://4.bp.blogspot.com/-wqCwBVHoSUA/UxoPo06LF6I/AAAAAAAAE_c/dFStYMspM6I/s1600/Screenshot+2014-03-07+22.27.33.png"
  imageanchor="1"><img border="0"
                       src="http://4.bp.blogspot.com/-wqCwBVHoSUA/UxoPo06LF6I/AAAAAAAAE_c/dFStYMspM6I/s320/Screenshot+2014-03-07+22.27.33.png"
/></a> <p>Similar builds under <em>Docker</em>:</p><a
  href="http://1.bp.blogspot.com/-pEaoiCMbMUc/UxoQIpT6V5I/AAAAAAAAE_k/EkfOPZ-L29w/s1600/Screenshot+2014-03-07+22.29.46.png"
  imageanchor="1"><img border="0"
                       src="http://1.bp.blogspot.com/-pEaoiCMbMUc/UxoQIpT6V5I/AAAAAAAAE_k/EkfOPZ-L29w/s320/Screenshot+2014-03-07+22.29.46.png"
/></a> <h2>What is is for</h2><p>In the next posts I'll cover details on how to use
  TeamCity.Virtual plugin to run builds with <em>Nodejs</em>, <em>JVM</em>, <em>Android</em>
  and much more. Remember, all you need to configure for build agents is Docker or Vagrant. Here are links for
  publicly available images: <a href="http://www.vagrantbox.es/">Vagrant Boxes</a> and <a
    href="https://github.com/dotcloud/docker/wiki/Public-docker-images">Docker Images</a></p> <h2>Download
  and Run</h2><p>Plugin is implemented under Apache 2.0. Sources are on <a
  href="https://github.com/jonnyzzz/TeamCity.Virtual">GitHub</a>. Builds are set up and running in <a
  href="http://teamcity.jetbrains.com/viewType.html?buildTypeId=TeamCityVirtual_Build&guest=1">TeamCity</a>.
</p><p>For more details, see <a
  href="https://github.com/jonnyzzz/TeamCity.Virtual/blob/master/README.md">README.md</a></p> <p>Your
  <a href="https://github.com/jonnyzzz/TeamCity.Virtual/issues">feedback</a> is welcome! Share what you
  think</p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jonnyzzz'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2013/12/18/try-with-resource-in-java/" class="btn" title="Try-With-Resource in Java">Previous</a>
      
      
        <a href="/blog/2014/04/26/named-stack-frames-for-jvm/" class="btn" title="Named Stack Frames for the JVM">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2005—2015 Eugene Petrenko. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/jonnyzzz" title="Eugene Petrenko on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/jonnyzzz" title="Eugene Petrenko on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	<a href="https://plus.google.com/+EugenePetrenko_jonnyzzz" title="Eugene Petrenko on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	<a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/49811/eugene-petrenko" title="Eugene Petrenko on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	<a href="https://instagram.com/jonnyzzz" title="Eugene Petrenko on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	<a href="https://www.flickr.com/photos/_jonny_" title="Eugene Petrenko on Flickr" target="_blank"><i class="fa fa-flickr fa-2x"></i></a>
	<a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  <a href="https://www.pinterest.com/jonnyzzz/" title="Eugene Petrenko on Pinterest" target="_blank"><i class="fa fa-pinterest fa-2x"></i></a>
	
  <a href="/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = '';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-70104598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
