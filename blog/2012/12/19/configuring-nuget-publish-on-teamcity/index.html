<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Configuring NuGet publish on TeamCity &#8211; Eugene Petrenko</title>

<meta name="keywords" content="nuget, ci, teamcity, build">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Configuring NuGet publish on TeamCity">

<meta name="twitter:site" content="@jonnyzzz">
<meta name="twitter:creator" content="@jonnyzzz">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Configuring NuGet publish on TeamCity">

<meta property="og:url" content="/blog/2012/12/19/configuring-nuget-publish-on-teamcity/">
<meta property="og:site_name" content="Eugene Petrenko">





<link rel="canonical" href="/blog/2012/12/19/configuring-nuget-publish-on-teamcity/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Eugene Petrenko Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="/assets/js/vendor/html5shiv.min.js"></script>
  <script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<!--<link rel="shortcut icon" href="/favicon.ico">-->
<!-- 32x32 -->
<!--<link rel="shortcut icon" href="/favicon.png">-->
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<!--<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">-->
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<!--<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">-->
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<!--<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">-->
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">-->


<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"light-bottom"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->


<!--SYNTAX HIGHLIGHTER BEGINS-->

<script src="/assets/syntax/syntax.js"></script>

<link rel="stylesheet" href="/assets/syntax/syntax.css" />

<!--SYNTAX HIGHLIGHTER ENDS-->


</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="/blog/" >Blog</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="/">Eugene Petrenko</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Eugene @jonnyzzz Petrenko personal page and blog</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#nuget" title="Pages tagged nuget">nuget</a></li><li><a href="/tags/#ci" title="Pages tagged ci">ci</a></li><li><a href="/tags/#teamcity" title="Pages tagged teamcity">teamcity</a></li><li><a href="/tags/#build" title="Pages tagged build">build</a></li>
        </ul>
        
          <h1 class="entry-title">Configuring NuGet publish on TeamCity</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
          <img src="/images/me.jpg" class="bio-photo" alt="Eugene Petrenko bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Eugene Petrenko</span></span>
        <span class="entry-date date published"><time datetime="2012-12-19T10:30:00+01:00"><i class="fa fa-calendar-o"></i> December 19, 2012</time></span>
        <span class="entry-date date modified"><time datetime="2012-12-19T10:30:46.316+01:00"><i class="fa fa-pencil"></i> December 19, 2012</time></span>
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
      </footer>
      <div class="entry-content">
        <p>In this post I'll describe the solution I used to publish/promote builds of 3 version
  of <a href="https://github.com/JetBrains/TeamCity.ServiceMessages">TeamCity.ServiceMessages</a>
  library to NuGet.org via TeamCity.</p><h3>Package Build Setup</h3><p>I moved <a
  href="https://github.com/JetBrains/TeamCity.ServiceMessages">TeamCity.ServiceMessages</a> builds to <a
  href="http://teamcity.jetbrains.com/">teamcity.jetbrains.com</a>. There are 3 active versions of the
  library. It was necessary to re-use build setup in TeamCity. So I used <a
    href="http://confluence.jetbrains.net/display/TCD7/Build+Configuration+Template">build configuration template</a>
  for it. The template contains steps to fetch NuGet dependencies, to patch <a
    href="http://confluence.jetbrains.net/display/TCD7/AssemblyInfo+Patcher">assemblies version</a>, to build
  Visual Studio solution, to run NUnit tests under dotCover code coverage, and to package the library as NuGet
  package. The template is parametrized by library version and Git branch name.</p> <p>I decided to
  avoid publishing from the template. It's not necessary to publish packages from all builds. I suppose, it's normal
  to have some test builds prior to releasing them. So the goal is to create a specific build(s) to implement
  publishing of selected package only</p> <h3>Package Publish Setup</h3><p>The easiest way
  to implement publishing is to create a build configuration for each of package versions. This would make me to
  copy 3 same configurations.</p> <p>There is another approach with help of <a
  href="http://confluence.jetbrains.net/display/TCD7/Typed+Parameters">Typed Parameters</a>.</p><p>I
  created one build configuration with TeamCity reference instead of packages to publish in NuGet Publish runner:</p>
<a href="http://1.bp.blogspot.com/-vs223E57nzY/UM8-u6YI3rI/AAAAAAAACNk/VtwHKOl6Ibw/s1600/Image_0014.png"
   imageanchor="1"><img border="0" height="161"
                        src="http://1.bp.blogspot.com/-vs223E57nzY/UM8-u6YI3rI/AAAAAAAACNk/VtwHKOl6Ibw/s640/Image_0014.png"
                        width="640"/></a>
<p>Here I use the following <strong>*%serviceMessages.packagesToPublish%*.nupkg</strong>. I can
  specify wildcard as TeamCity Property in <a
    href="http://confluence.jetbrains.net/display/TCD7/Configuring+Build+Parameters"><em>Build Parameters</em></a>
  section of build configuration settings.</p><p>Next I specify <strong>%serviceMessages.packagesToPublish%</strong>
  property for the Build Parameters section of build configuration configuration:</p>
<div style="float:
      left;"><a
  href="http://2.bp.blogspot.com/-q-IJu-J7n7E/UM8_jWXf8uI/AAAAAAAACNw/qav2__vuqsQ/s1600/Image_0016.png"
  imageanchor="1"><img border="0" height="320"
                       src="http://2.bp.blogspot.com/-q-IJu-J7n7E/UM8_jWXf8uI/AAAAAAAACNw/qav2__vuqsQ/s320/Image_0016.png"
                       width="296"/></a></div>
<div
  style="float: left;"><a
  href="http://3.bp.blogspot.com/-_RUlN2fy_rg/UM8_oRkEcyI/AAAAAAAACN8/NVxVrs9036A/s1600/Image_0018.png"
  imageanchor="1"><img border="0" height="320"
                       src="http://3.bp.blogspot.com/-_RUlN2fy_rg/UM8_oRkEcyI/AAAAAAAACN8/NVxVrs9036A/s320/Image_0018.png"
                       width="316"/></a></div>
<div
  style="clear: both;"></div> <p>Here I use <a
  href="http://confluence.jetbrains.net/display/TCD7/Typed+Parameters">Typed Parameter</a> to implement
  drop-down. I also mark parameter as required in order to make TeamCity show custom run dialog for me on every run
  button click. This build is started only implicitly, so I have no build triggers.</p><p>I added an
  artifact dependency from all 3 of my build configurations. The values of
  <strong>%serviceMessages.packagesToPublish%</strong>
  are selected in the way to select only one of 3 NuGet packages.</p><a
  href="http://4.bp.blogspot.com/-eCSuC7gbcc0/UM9BByZzFGI/AAAAAAAACOI/qT-3xB6FQSA/s1600/Image_0020.png"
  imageanchor="1"><img border="0" height="113"
                       src="http://4.bp.blogspot.com/-eCSuC7gbcc0/UM9BByZzFGI/AAAAAAAACOI/qT-3xB6FQSA/s320/Image_0020.png"
                       width="320"/></a>
<h3>Starting the Build</h3><p>Now when I start the publish build I see the following dialog</p>
<a href="http://3.bp.blogspot.com/-mTrsOIKJOqw/UM9BYaa4HrI/AAAAAAAACOU/Gcd6690V_XQ/s1600/Image_0022.png"
   imageanchor="1"><img border="0" height="134"
                        src="http://3.bp.blogspot.com/-mTrsOIKJOqw/UM9BYaa4HrI/AAAAAAAACOU/Gcd6690V_XQ/s320/Image_0022.png"
                        width="320"/></a>
<p>I can select the the build configuration of the library with latest successful package I want to publish
  with NuGet. Thanks to <strong>Dependencies</strong> tab I can override the artifact if necessary.</p>
<h3>Side Notes</h3><p>Note, this trick will only work if you are able to write wildcards that
  matches only necessary packages that were downloaded from one build configuration. From the other hand, you may
  download packages from each configuration to different folders making wildcards even simpler</p><p>The
  project is available <a href="http://teamcity.jetbrains.com/project.html?projectId=project75">here</a></p>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jonnyzzz'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/2012/12/17/teamcityservicemessages-from-powershell/" class="btn" title="TeamCity.ServiceMessages from Powershell">Previous</a>
      
      
        <a href="/blog/2013/01/10/transfer-environment-between-build-steps/" class="btn" title="Transfer Environment Between Build Steps">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2015 Eugene Petrenko. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/jonnyzzz" title="Eugene Petrenko on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/jonnyzzz" title="Eugene Petrenko on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	<a href="https://plus.google.com/+EugenePetrenko_jonnyzzz" title="Eugene Petrenko on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	<a href="https://linkedin.com/in/jonnyzzz" title="Eugene Petrenko on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/49811/eugene-petrenko" title="Eugene Petrenko on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	<a href="https://instagram.com/jonnyzzz" title="Eugene Petrenko on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	<a href="https://www.flickr.com/photos/_jonny_" title="Eugene Petrenko on Flickr" target="_blank"><i class="fa fa-flickr fa-2x"></i></a>
	<a href="https://github.com/jonnyzzz" title="Eugene Petrenko on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  <a href="https://www.pinterest.com/jonnyzzz/" title="Eugene Petrenko on Pinterest" target="_blank"><i class="fa fa-pinterest fa-2x"></i></a>
	
  <a href="/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = '';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-70104598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
